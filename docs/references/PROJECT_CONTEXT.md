# Noahプロジェクトコンテキスト

このドキュメントは、Noahがタスクを効率的に実行するために必要な、プロジェクトの基本的な文脈情報を提供します。

## プロジェクトの目的

Noahは安全かつ柔軟なパーソナルアシスタント的AIエージェントとして機能することを目指しています。主な目標は：

1. 安全性と制御可能性の確保
2. 柔軟な機能拡張の実現
3. 効率的なタスク実行の支援
4. マルチエージェント連携の実現

### Autonomous Agent実装

プロジェクトは以下の2つの基本的な柱に基づいてAIエージェントを実装しています：

1. Task Management層
   - タスクの分解と計画立案機能
   - 実行管理と進捗モニタリング
   - エージェント間協調の制御
   - エラー検出と回復メカニズム

2. Intelligence層
   - LLMベースの意思決定エンジン
   - 特化型学習モデル（SLM）連携
   - RAGによる知識ベースアクセス
   - 履歴に基づく学習と適応

これらの機能は以下の特徴を持ちます：

- 柔軟なマルチエージェント構成
  * 機能別の特化型エージェント
  * 動的な役割分担と協調
  * 分散状態管理

- 階層的なタスク管理
  * 目標からの段階的分解
  * リソースと依存関係の管理
  * 実行状況のリアルタイム監視

- 適応的な学習機能
  * 会話履歴からの学習
  * パターン分析と最適化
  * プライバシー考慮の情報管理

## リポジトリ構造の基本概念

### コアコンポーネント（/extensions/core）

- プロジェクトの中核機能を提供
- 拡張機能の基盤となるインターフェースと型定義を管理
- MCPサーバーとの通信プロトコルを標準化
- 環境互換性の検証と管理

### MCPサーバー管理（/MCP）

- config/: 新しい設定管理システム
  - env.json: 環境変数定義（標準化された命名規則に従う）
  - base.json: 基本設定テンプレート
  - development.json: 開発環境設定
  - README.md: 設定管理ドキュメント
- servers/: 標準MCPサーバー（サブモジュール）
  - postgres/: PostgreSQLサーバー（読み取り専用）
  - sqlite/: SQLiteサーバー
  - filesystem/: ファイル操作サーバー
  - memory/: 知識グラフメモリサーバー
  - その他: 段階的に実装予定

### サーバー実装方針

1. 標準MCPサーバーの優先利用
   - Model Context Protocol Serversの活用
   - READMEベースの実装プロセス
   - カスタム実装の回避

2. 実装プロセス
   - サーバーREADMEの精読と機能確認
   - 設定要件の特定と環境変数の準備
   - 許可ツール（alwaysAllow）の明示的な設定
   - generate-config.ps1による設定の反映

3. 実装状況
   - フェーズ1（基本インフラストラクチャ）
     * SQLite: 標準MCPサーバーによるデータベースアクセス
     * PostgreSQL: 読み取り専用データベースアクセス
     * Filesystem: NOAH_DATA_PATHに制限されたファイル操作
     * Memory: 知識グラフベースの永続メモリシステム
   - フェーズ2（開発支援ツール）
     * Git: リポジトリ操作の基盤
     * GitHub: GitHub API連携
     * GitLab: GitLab API連携
     * Puppeteer: ブラウザ自動化
   - フェーズ3（外部サービス連携）
     * Google Drive: ファイルアクセス
     * Google Maps: 位置情報サービス
     * Slack: チャネル管理
     * Sentry: エラー追跡
   - フェーズ4（特殊機能）
     * EverArt: AI画像生成
     * Sequential Thinking: 思考プロセス管理
     * Time: 時間管理
     * Everything: テスト/リファレンス

### コンテキスト定義（/standards/_meta/contexts）

プロジェクトの動作を定義する4つの主要なコンテキストファイルを管理：

1. グローバルコンテキスト（global_context.yaml, v1.2.0）
   - プロジェクト全体の設定と基準を定義
   - AIエージェントの基本動作パラメータ
   - MCPフレームワーク標準準拠のエラー管理
   - JSON-RPC 2.0ベースの通信プロトコル
   - 品質管理指針と依存関係管理

2. プロセスコンテキスト（process_context.yaml, v1.2.0）
   - プロセス実行環境の詳細設定
   - 状態管理とトランジションの定義
   - メトリクス収集と分析パラメータ
   - エラーハンドリングポリシー（2段階重要度）

3. MCPコンテキスト（mcp_context.yaml, v1.2.0）
   - サーバー定義と設定パラメータ
   - MCPプロトコル標準準拠の通信
   - エラー管理の標準化（2段階重要度）
   - サーバー機能の明確化
   - サンプリング機能の強化

4. 統一メトリクス定義（unified_metrics.yaml, v1.2.0）
   - システムメトリクスの標準定義
     * CPU、メモリ、ディスク使用率の閾値
     * パフォーマンス指標の基準値
     * リソース使用状況の監視基準
   - アラートポリシーの一元管理
     * 重要度別の通知設定
     * 自動リカバリー条件
     * エスカレーションルール
   - レポート形式の標準化
     * メトリクス情報の統一フォーマット
     * 集計方法の定義
     * 保存期間の設定

### 外部連携（/MCP/servers）

- Model Context Protocol Serversをサブモジュールとして管理
- 標準化された19個のMCPサーバーを提供
- サブモジュールによる一貫したバージョン管理
- 本体との疎結合を維持しながら機能を拡張

### 設定管理（/extensions/configs）

- MCPサーバーの設定
- プロンプトのカスタマイズ
- コア機能の動作設定

## 重要な運用ルール

1. バージョン管理
   - semantic-releaseによるバージョニング
   - 更新戦略は設定ファイルで明示的に制御

2. 品質管理
   - TypeScriptによる型安全性の確保
   - ESLint/Prettierによるコード品質の維持
   - Jestによるテスト自動化
   - テストカバレッジ80%以上の維持

3. ドキュメント管理
   - 引継ぎ文書の履歴管理（/docs/archive）
   - APIドキュメントの整備
   - 変更履歴の明確な記録

## タスク実行時の重要な考慮事項

1. エラー管理（MCPフレームワーク標準準拠）
   - 重要度別の対応時間
     * Critical（15分以内）: システム停止、セキュリティ違反、データ損失リスク
     * Non-Critical（60分以内）: 一般的なエラー、パフォーマンス低下、軽微な不具合
   - 自動リカバリー条件
     * リトライ戦略: 指数バックオフによる段階的リトライ
     * エラータイプの判断: Critical/Non-Criticalの2段階評価
     * リソース状態の監視: CPU、メモリ、ディスク使用率の標準化された管理

2. 環境変数
   - NOAH_HOME: Noahのホームディレクトリ
   - NOAH_CONFIG_PATH: 設定ファイルのパス

3. 依存関係
   - Node.js >= 20.0.0
   - npm >= 10.0.0
   - 外部MCPサーバーの互換性確認

4. セキュリティ考慮事項
   - 環境変数経由の認証情報管理
   - MCPサーバーの権限制御
   - 外部APIアクセスの制限

## MCPサーバーとの連携（MCPフレームワーク標準v1.2.0準拠）

1. サーバー管理
   - 新しい設定管理システム
     - 環境変数ベースのパス解決
     - 階層的な設定ファイル構造
     - 設定生成の自動化
   - 環境変数の標準化
     - 命名規則: [SERVER]_[CATEGORY]_[NAME]
     - カテゴリ分類: AUTH（認証）、PATH（パス）、CONFIG（設定）、API（エンドポイント）、ENV（環境）
     - 一貫性のある命名パターン
     - 集中管理による可視性の向上
   - 運用ルール
     - 設定変更時のgenerate-config.ps1実行
     - env.jsonでの環境変数管理
     - 環境変数によるパス指定
     - 標準命名規則の厳守
   - サブモジュール管理
     - Model Context Protocol Serversリポジトリの参照
     - 一貫性のあるバージョン管理
     - git submoduleによる更新管理

2. 通信プロトコル
   - トランスポート層
     - ローカル通信（stdio）
     - リモート通信（http_sse）
     - リモートMCPサポート
   - 認証メカニズム
     - OAuth2認証
     - トークンベース認証
   - サービスディスカバリー
     - DNS方式
     - HTTP方式
     - 手動設定

3. エージェントアーキテクチャ
   - 階層構造
     - Coordinator: タスク分配と進捗管理
     - Worker: 基本タスクの実行
     - Specialist: 専門的タスクの実行
   - ワークフロー管理
     - インタラクティブな実行
     - ストリーミング結果
     - 状態追跡

4. サンプリング機能
   - LLM補完要求
     - 直接サンプリング
     - 代替手段の提供
   - クライアント互換性
     - ツールベース補完
     - プロンプトベース補完

3. サーバー構成
   - 19個の標準サーバーを提供
     - データベース操作（PostgreSQL, SQLite）
     - クラウドサービス連携（Google Drive, Google Maps）
     - 開発支援（Git, GitHub, GitLab）
     - コミュニケーション（Slack）
     - エラー管理（Sentry）
     - AI機能（EverArt）
     - 思考プロセス（Sequential Thinking）
     - 時間管理（Time）
     - ユーティリティ（Filesystem, Memory, Everything）
   - 各サーバーの独立性を維持
   - 必要に応じた選択的有効化

4. 環境互換性の管理
   - 環境チェッカーによる自動検証
     - システム要件の確認（Node.js >= 20.0.0）
     - ランタイムの互換性チェック
     - 必要な環境変数の検証
   - 非互換サーバーの自動無効化
   - 互換性情報の明示的な管理

5. 認証情報とファイル管理
   - 認証情報の配置
     - /MCP/config/[サーバー名]/: 各サーバーの設定ファイル用ディレクトリ
     - 認証キーやトークンファイルは必ずconfig配下に配置
   - 環境変数による参照
     - 認証情報自体は環境変数で管理
     - ファイルパスも環境変数で指定
   - 命名規則
     - キーファイル: [認証種別].keys.json
     - トークンファイル: [認証種別].token.json
     - 環境変数: [サービス名]_[認証種別]_[項目]

6. サーバー設定の標準化
   - 基本設定項目
     - command: サーバー実行コマンド
     - args: コマンド引数の配列
     - disabled: 有効/無効フラグ
     - alwaysAllow: 常に許可する操作
     - env: 環境変数設定
   - Python系サーバーの追加設定
     - PYTHONPATH: ソースコードのパス
     - 仮想環境の使用
   - Node.js系サーバーの追加設定
     - 依存パッケージの管理
     - ビルド設定

## トラブルシューティング

1. 一般的な問題
   - 環境変数の設定ミス
   - 依存関係の競合
   - 認証情報の不整合
   - モジュール読み込みエラー

2. デバッグ手順
   - ログの確認方法
   - 設定の検証手順
   - テストの実行方法
   - サーバー固有の問題解決手順
     1. 環境変数の確認
     2. 設定ファイルの検証
     3. 認証情報の確認
     4. モジュールの再インストール
     5. 依存関係の更新

3. 一般的なエラーと解決方法
   - モジュール未検出エラー
     - PYTHONPATHの確認
     - モジュールの再インストール
   - 認証エラー
     - 環境変数の確認
     - キーファイルの配置確認
   - 接続エラー
     - サーバー状態の確認
     - ネットワーク設定の確認

## プロジェクトの将来的な方向性

1. 短期目標
   - 標準MCPサーバーへの完全移行
   - 環境変数の命名規則の完全適用
   - 設定管理システムの最適化
   - テスト実行の効率化
   - エラーハンドリングの強化

2. 中長期目標
   - マイクロサービスアーキテクチャの検討
   - CI/CDパイプラインの整備
   - MCPサーバー連携の強化
   - 自動化プロセスの拡充
   - ドキュメント体系の整備
   - モニタリング機能の拡充
   - コンテキスト定義の継続的改善
   - パフォーマンス最適化の実施

## 参考情報

1. 重要なファイル
   - package.json: プロジェクトの依存関係と設定
   - extensions/configs/extensions.json: MCPサーバーの設定
   - extensions/core/environment-checker: 環境互換性チェッカー
   - standards/_meta/contexts/: コンテキスト定義ファイル
   - docs/references/mcp_llm_reference.txt: MCPフレームワークのLLM向け詳細仕様

2. 外部リソース
   - MCPサーバーのリポジトリ
     - Model Context Protocol Servers: https://github.com/modelcontextprotocol/servers
     - Awesome MCP Servers: https://github.com/punkpeye/awesome-mcp-servers
   - 重要な参照ドキュメント
     - Model Context Protocol公式ドキュメント: https://modelcontextprotocol.io/introduction
     - MCPフレームワーク仕様書: docs/references/mcp_llm_reference.txt
   - 開発ガイドライン

このコンテキスト情報は、Noahがタスクを実行する際の基本的な理解と判断の基準として機能します。プロジェクトの発展に伴い、適宜更新されるべきです。